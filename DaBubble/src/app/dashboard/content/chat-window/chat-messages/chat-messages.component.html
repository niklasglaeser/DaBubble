<div class="chat-content">
    <div *ngIf="messages$ | async as messages" id="chat-messages-container">
        <div *ngFor="let message of messages"
            [ngClass]="message.senderId === currentUser?.uid ? 'user-send-message' : 'message'">
            <div class="message-date">{{ formatDate(message.created_at) }}</div>
            <div class="message-section">
                <div class="reaction-bar">
                    <div class="checkmark-reaction" (click)="toggleReaction(message, '✅')"></div>
                    <div class="applaud-reaction" (click)="toggleReaction(message, '🙌🏻')"></div>
                    <div class="emoji-reaction" (click)="toggleEmojiPicker(message.id ?? undefined, $event)"></div>
                    <div class="comment-reaction" (click)="openThread(channelId, message.id!, message)"></div>
                    <div *ngIf="currentUser?.uid === message.senderId" class="option-reaction"
                        (click)="editMessage(message)"></div>
                </div>
                <div class="message-content">
                    <img class="author-picture" [src]="message.photoURL">
                    <div class="details">
                        <div class="author">
                            <div class="author-name fs-18-700">{{message.senderName}}</div>
                            <div class="message-send-time fs-14">{{ formatTime(message.created_at) }} Uhr</div>
                        </div>
                        <div *ngIf="!(editMessageClicked && selectedMessage?.id === message.id); else editTemplate"
                            class="text fs-18">
                            {{message.message}}
                        </div>
                        <ng-template #editTemplate>
                            <div class="edit-channel">
                                <textarea class="text fs-18" [(ngModel)]="editMessageText"></textarea>
                            </div>
                            <span class="edit" (click)="saveEditedMessage()">Speichern</span>
                            <span class="edit" (click)="cancelEdit()">Abbrechen</span>
                        </ng-template>
                        <div class="open-thread">
                            <div class="open-answers fs-18" (click)="openThread(channelId, message.id!, message)">
                                <span *ngIf="getReplayCount(message.id!)">
                                    {{ threadCounts.get(message.id!) }} Antworten
                                </span>
                            </div>
                            <div class="fs-14 last-answer">
                                <span *ngIf="getAnswerTime(message.id!) as answerTime">
                                    Letzte Antwort: {{ formatTime(answerTime) }}
                                </span>
                            </div>
                            <div class="reactions">
                                <div *ngFor="let reaction of message.reactions" class="emoji-container"
                                    [matTooltip]="getReactionTooltip(reaction)"
                                    (click)="toggleReaction(message, reaction.emoji)">
                                    <div class="emoji">
                                        {{ reaction.emoji }}
                                    </div>
                                    <div class="emoji-counter">{{ reaction.count }}</div>
                                </div>
                                <div class="add-reaction" (click)="toggleEmojiPicker(message.id ?? undefined, $event)">
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
                <div *ngIf="emojiPickerMessageId === message.id" class="emoji-picker-dialog">
                    <emoji-mart (emojiClick)="addEmoji($event, message)"></emoji-mart>
                </div>
            </div>
        </div>
    </div>
</div>